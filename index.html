<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Order App Pro</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
  <div class="card">

    <div class="top-bar">
      <h2>üçΩ Order App Pro</h2>
      <button class="toggle-btn" onclick="toggleDarkMode()">üåô</button>
    </div>

    <form id="orderForm">
      <div class="input-group">
        <label>Nama</label>
        <input type="text" id="nama" required>
      </div>

      <!-- MENU -->
      <div class="input-group">
        <label>Pilih Menu</label>
        <select id="menu">
          <option value="" data-harga="0">-- Pilih Menu --</option>
          <option value="Nasi Goreng" data-harga="15000">Nasi Goreng</option>
          <option value="Mie Ayam" data-harga="12000">Mie Ayam</option>
          <option value="Bakso" data-harga="13000">Bakso</option>
        </select>
        <small id="hargaMenu">Harga: Rp 0</small>
      </div>

      <!-- MINUM -->
      <div class="input-group">
        <label>Pilih Minum</label>
        <select id="minum">
          <option value="" data-harga="0">-- Pilih Minum --</option>
          <option value="Air Putih" data-harga="3000">Air Putih</option>
          <option value="Es Teh" data-harga="5000">Es Teh</option>
          <option value="Jus" data-harga="8000">Jus</option>
        </select>
        <small id="hargaMinum">Harga: Rp 0</small>
      </div>

      <!-- MENU LAINNYA -->
      <div class="input-group">
        <label>Menu Lainnya</label>
        <select id="lainnya">
          <option value="" data-harga="0">-- Pilih Menu Tambahan --</option>
          <option value="Kentang" data-harga="15000">Kentang</option>
          <option value="Sosis" data-harga="10000">Sosis</option>
          <option value="Nugget" data-harga="12000">Nugget</option>
        </select>
        <small id="hargaLainnya">Harga: Rp 0</small>
      </div>

      <!-- TOTAL -->
      <div class="input-group">
        <label>Total Harga</label>
        <input type="text" id="totalHarga" readonly value="Rp 0">
      </div>

      <div class="input-group">
        <label>Upload Foto Bukti Transfer Dana <br> kirim ke no Dana 082335740491</label>
        <input type="file" id="foto" accept="image/*" required>
      </div>

      <button type="submit">Simpan Pesanan</button>
    </form>

    <hr>

    <h3>üìã Data Pesanan</h3>
<table>
  <thead>
    <tr>
      <th>No</th>
      <th>Nama</th>
      <th>Menu</th>
      <th>Minum</th>
      <th>Lainnya</th>
      <th>Total</th>
      <th>Foto</th>
    </tr>
  </thead>
  <tbody id="orderList"></tbody>
</table>

  </div>
</div>

<div id="toast" class="toast"></div>

<script>

const scriptURL = "https://script.google.com/macros/s/AKfycbzbXyyp36STo1CTwo74mEwxudpcKKt2f5nW9YZFmr84GgFUqVmi6pzQBB35OKjRbYHDZw/exec";

// ==========================
// LOAD DATA
// ==========================
window.onload = function() {
  fetch(scriptURL)
    .then(res => res.json())
    .then(data => {
      data.forEach((row, index) => {
  addToTable(
    index + 1,
    row[1],  // nama
    row[2],  // menu
    row[3],  // minum
    row[4],  // lainnya
    row[5],  // total
    row[6]   // foto
  );
});
    });
};

// ==========================
// HITUNG TOTAL
// ==========================
const menuSelect = document.getElementById("menu");
const minumSelect = document.getElementById("minum");
const lainnyaSelect = document.getElementById("lainnya");

menuSelect.addEventListener("change", updateAll);
minumSelect.addEventListener("change", updateAll);
lainnyaSelect.addEventListener("change", updateAll);

function updateAll(){
  hitungTotal();
  simpanDraft();
}

function hitungTotal() {

  const hargaMenu = parseInt(menuSelect.options[menuSelect.selectedIndex].dataset.harga);
  const hargaMinum = parseInt(minumSelect.options[minumSelect.selectedIndex].dataset.harga);
  const hargaLainnya = parseInt(lainnyaSelect.options[lainnyaSelect.selectedIndex].dataset.harga);

  document.getElementById("hargaMenu").innerText =
    "Harga: Rp " + hargaMenu.toLocaleString("id-ID");

  document.getElementById("hargaMinum").innerText =
    "Harga: Rp " + hargaMinum.toLocaleString("id-ID");

  document.getElementById("hargaLainnya").innerText =
    "Harga: Rp " + hargaLainnya.toLocaleString("id-ID");

  const total = hargaMenu + hargaMinum + hargaLainnya;

  document.getElementById("totalHarga").value =
    "Rp " + total.toLocaleString("id-ID");
}

// ==========================
// SIMPAN PESANAN
// ==========================
document.getElementById("orderForm").addEventListener("submit", function(e) {
  e.preventDefault();

  const nama = document.getElementById("nama").value;
  const menu = menuSelect.value;
  const minum = minumSelect.value;
  const lainnya = lainnyaSelect.value;
  const total = document.getElementById("totalHarga").value;
  const file = document.getElementById("foto").files[0];

  const reader = new FileReader();
  reader.onload = function() {

    fetch(scriptURL, {
  method: "POST",
  body: JSON.stringify({
    action: "add",
    nama: nama,
    menu: menu,
    minum: minum,
    lainnya: lainnya,
    total: total,
    foto: reader.result
  })
})
    .then(res => res.json())
    .then(() => {
      localStorage.clear();
      showToast("‚úÖ Pesanan tersimpan!", "success");
      location.reload();
    });
  };
  reader.readAsDataURL(file);
});

// ==========================
// AUTO SAVE (ANTI HILANG)
// ==========================
document.getElementById("nama").addEventListener("input", simpanDraft);

function simpanDraft(){
  localStorage.setItem("draftNama", document.getElementById("nama").value);
  localStorage.setItem("draftMenu", menuSelect.value);
  localStorage.setItem("draftMinum", minumSelect.value);
  localStorage.setItem("draftLainnya", lainnyaSelect.value);
  localStorage.setItem("draftTotal", document.getElementById("totalHarga").value);
}

window.addEventListener("DOMContentLoaded", function(){
  if(localStorage.getItem("draftNama"))
    document.getElementById("nama").value = localStorage.getItem("draftNama");

  if(localStorage.getItem("draftMenu"))
    menuSelect.value = localStorage.getItem("draftMenu");

  if(localStorage.getItem("draftMinum"))
    minumSelect.value = localStorage.getItem("draftMinum");

  if(localStorage.getItem("draftLainnya"))
    lainnyaSelect.value = localStorage.getItem("draftLainnya");

  hitungTotal();
});

// ==========================
// TABLE
// ==========================
function addToTable(no, nama, menu, minum, lainnya, total, fotoUrl) {
  const table = document.getElementById("orderList");
  const row = table.insertRow();

  row.innerHTML = `
    <td>${no}</td>
    <td>${nama}</td>
    <td>${menu}</td>
    <td>${minum}</td>
    <td>${lainnya}</td>
    <td>${total}</td>
    <td><a href="${fotoUrl}" target="_blank">Lihat</a></td>
  `;
}

function deleteOrder(rowNumber) {
  fetch(scriptURL, {
    method: "POST",
    body: JSON.stringify({
      action: "delete",
      row: rowNumber + 1
    })
  })
  .then(res => res.json())
  .then(() => location.reload());
}

function toggleDarkMode() {
  document.body.classList.toggle("dark");
}

function showToast(message, type) {
  const toast = document.getElementById("toast");
  toast.innerText = message;
  toast.className = "toast show " + type;
  setTimeout(() => toast.className = "toast", 3000);
}

</script>

</body>
</html>
