<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Menu Makan dan Minum BukBer IKA</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
  <div class="card">

    <div class="top-bar">
      <h2>üçΩ Selamat Datang <br> Silahkan Isi Data dibawah ini</h2>
      <button class="toggle-btn" onclick="toggleDarkMode()">üåô</button>
    </div>

    <form id="orderForm">
      <div class="input-group">
        <label>Nama</label>
        <input type="text" id="nama" required>
      </div>

      <div class="input-group">
        <label>Pilih Menu</label>
        <select id="menu">
          <option value="" data-harga="0">-- Pilih Menu --</option>
          <option value="Nasi Goreng" data-harga="15000">Nasi Goreng</option>
          <option value="Mie Ayam" data-harga="12000">Mie Ayam</option>
          <option value="Bakso" data-harga="13000">Bakso</option>
        </select>
        <small id="hargaMenu">Harga: Rp 0</small>
      </div>
      
      <div class="input-group">
        <label>Pilih Minum</label>
        <select id="minum">
          <option value="" data-harga="0">-- Pilih Minum --</option>
          <option value="Air Putih" data-harga="3000">Air Putih</option>
          <option value="Es Teh" data-harga="5000">Es Teh</option>
          <option value="Jus" data-harga="8000">Jus</option>
        </select>
        <small id="hargaMinum">Harga: Rp 0</small>
      </div>
      
      <div class="input-group">
        <label>Total Harga</label>
        <input type="text" id="totalHarga" readonly value="Rp 0">
      </div>

      <div class="input-group">
        <label>Upload Foto Bukti Transfer Dana <br> kirim ke no Dana 082335740491 </label>
        <input type="file" id="foto" accept="image/*" required>
      </div>

      <button type="submit">Simpan Pesanan</button>
    </form>
<div class="maps">
   <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d5101.170831402099!2d113.2485928!3d-7.7602258000000015!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2dd7ad0048448d8b%3A0xda8db517ae59dfd9!2sNKS%20COFFEE!5e1!3m2!1sid!2sid!4v1771724105090!5m2!1sid!2sid" width="400" height="300" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
</div>
    <hr>

    <h3>üìã Data Pesanan</h3>
    <table>
      <thead>
        <tr>
          <th>No</th>
          <th>Nama</th>
          <th>Menu</th>
          <th>Foto</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody id="orderList"></tbody>
    </table>

  </div>
</div>

<div id="toast" class="toast"></div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbyowUMDVOIebscluvQu-uIifleRtkXn9qweVRR0hy1xlCKXZHDtPpPMlA_-TmldMaiN/exec";

// LOAD DATA DARI SPREADSHEET
window.onload = function() {
  fetch(scriptURL)
    .then(res => res.json())
    .then(data => {
      data.forEach((row, index) => {
        addToTable(index + 1, row[1], row[2], row[3]);
      });
    });
};

// SIMPAN
document.getElementById("orderForm").addEventListener("submit", function(e) {
  e.preventDefault();

  const nama = document.getElementById("nama").value;
  const menu = document.getElementById("menu").value;
  const file = document.getElementById("foto").files[0];

  const reader = new FileReader();
  reader.onload = function() {

    const minum = document.getElementById("minum").value;
const total = document.getElementById("totalHarga").value;

fetch(scriptURL, {
  method: "POST",
  body: JSON.stringify({
    action: "add",
    nama: nama,
    menu: menu,
    minum: minum,
    total: total,
    foto: reader.result
  })
})
    .then(res => res.json())
    .then(() => {
      showToast("‚úÖ Pesanan tersimpan!", "success");
      location.reload();
    });

  };
  reader.readAsDataURL(file);
});

// HAPUS
function deleteOrder(rowNumber) {
  fetch(scriptURL, {
    method: "POST",
    body: JSON.stringify({
      action: "delete",
      row: rowNumber + 1
    })
  })
  .then(res => res.json())
  .then(() => {
    showToast("üóë Data dihapus!", "success");
    location.reload();
  });
}

function addToTable(no, nama, menu, fotoUrl) {
  const table = document.getElementById("orderList");
  const row = table.insertRow();

  row.innerHTML = `
    <td>${no}</td>
    <td>${nama}</td>
    <td>${menu}</td>
    <td><a href="${fotoUrl}" target="_blank">Lihat</a></td>
    <td><button class="delete-btn" onclick="deleteOrder(${no})">Hapus</button></td>
  `;
}

function toggleDarkMode() {
  document.body.classList.toggle("dark");
}

function showToast(message, type) {
  const toast = document.getElementById("toast");
  toast.innerText = message;
  toast.className = "toast show " + type;

  setTimeout(() => {
    toast.className = "toast";
  }, 3000);
}

// ===============================
// AUTO SAVE FORM (ANTI HILANG)
// ===============================

// Simpan setiap kali user mengetik
document.getElementById("nama").addEventListener("input", function() {
  localStorage.setItem("draftNama", this.value);
});

document.getElementById("menu").addEventListener("change", function() {
  localStorage.setItem("draftMenu", this.value);
});

// Load kembali saat halaman dibuka
window.addEventListener("DOMContentLoaded", function() {
  const savedNama = localStorage.getItem("draftNama");
  const savedMenu = localStorage.getItem("draftMenu");

  if (savedNama) {
    document.getElementById("nama").value = savedNama;
  }

  if (savedMenu) {
    document.getElementById("menu").value = savedMenu;
  }
});

// Hapus draft setelah berhasil submit
document.getElementById("orderForm").addEventListener("submit", function() {
  localStorage.removeItem("draftNama");
  localStorage.removeItem("draftMenu");
});

// ==========================
// HITUNG HARGA OTOMATIS
// ==========================

const menuSelect = document.getElementById("menu");
const minumSelect = document.getElementById("minum");

menuSelect.addEventListener("change", hitungTotal);
minumSelect.addEventListener("change", hitungTotal);

function hitungTotal() {

  const hargaMenu = parseInt(menuSelect.options[menuSelect.selectedIndex].dataset.harga);
  const hargaMinum = parseInt(minumSelect.options[minumSelect.selectedIndex].dataset.harga);

  document.getElementById("hargaMenu").innerText =
    "Harga: Rp " + hargaMenu.toLocaleString("id-ID");

  document.getElementById("hargaMinum").innerText =
    "Harga: Rp " + hargaMinum.toLocaleString("id-ID");

  const total = hargaMenu + hargaMinum;

  document.getElementById("totalHarga").value =
    "Rp " + total.toLocaleString("id-ID");
}
</script>

</body>
</html>
